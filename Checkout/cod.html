<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secure Checkout (COD) - Hammer of Night Rider</title>
  <link rel="stylesheet" href="../css/theme-overrides.css" />
  <style>
    :root{ --border:#e5e7eb; --muted:#6b7280; --bg:#f6f7f8; --card:#ffffff; --shadow:0 10px 26px rgba(0,0,0,.06);}    
    html,body{ height:100%; }
    body{ margin:0; background:var(--bg); color:#111; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    .container{ max-width:1080px; margin:24px auto; padding:16px; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); overflow:hidden; }
    header.brand{ display:flex; align-items:center; justify-content:space-between; padding:16px 22px; border-bottom:1px solid var(--border); }
    header .title{ font-weight:800; letter-spacing:.2px; font-size:18px; }
    header .cod{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0f0f12; color:#fff; font-size:12px; border:1px solid #1d1d21; }
    header .brand-accent{ color: var(--brand-primary); }

    .content{ display:grid; grid-template-columns: 1.2fr .8fr; gap: 24px; padding:20px; }
    @media (max-width: 920px){ .content{ grid-template-columns: 1fr; } }

    .section{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:18px; }
    .section h2{ font-size:16px; margin:0 0 12px; }
    .muted{ color:var(--muted); }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width: 560px){ .grid-2{ grid-template-columns:1fr; } }

    label{ display:block; font-size:13px; margin:10px 0 6px; color:#222; }
    input, select, textarea{ width:100%; border:1px solid var(--border); border-radius:8px; padding:10px 12px; font-size:14px; background:#fff; }
    .inline{ display:flex; align-items:center; gap:10px; }
    .help{ font-size:12px; color:var(--muted); }

    .summary .item{ display:flex; gap:14px; align-items:center; }
    .summary .item img{ width:96px; height:auto; border-radius:10px; border:1px solid var(--border); }
    .summary .name{ font-weight:700; }
    .summary .sku{ font-size:12px; color:var(--muted); }
    .summary .price{ font-weight:800; font-size:18px; }
    .hr{ border:none; border-top:1px solid var(--border); margin:12px 0; }

    .totals{ display:grid; gap:8px; font-size:14px; }
    .totals .line{ display:flex; justify-content:space-between; }
    .totals .total{ font-size:18px; font-weight:800; }

    .actions{ margin-top:14px; display:flex; flex-direction:column; gap:10px; }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 16px; border-radius:10px; border:1px solid transparent; cursor:pointer; font-weight:800; text-decoration:none; }
    .btn-primary{ background: var(--brand-primary); color: var(--brand-on-primary); border-color: var(--brand-primary); }
    .btn-primary:hover{ background: var(--brand-primary-dark); border-color: var(--brand-primary-dark); }

    footer{ text-align:center; font-size:12px; color:var(--muted); padding:18px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header class="brand">
        <div class="title">HAMMER OF <span class="brand-accent">NIGHT RIDER</span> • Secure Checkout</div>
        <div class="cod">Cash on Delivery</div>
      </header>
      <div class="content">
        <form id="codForm" onsubmit="return false;">
          <div class="section">
            <h2>Contact</h2>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
            <label for="phone">Phone (for delivery confirmation)</label>
            <input id="phone" name="phone" type="tel" autocomplete="tel" required />
            <p class="help">We'll only use your phone to coordinate the delivery.</p>
          </div>

          <div class="section" style="margin-top:14px;">
            <h2>Shipping address</h2>
            <div class="grid-2">
              <div>
                <label for="firstName">First name</label>
                <input id="firstName" name="firstName" autocomplete="given-name" required />
              </div>
              <div>
                <label for="lastName">Last name</label>
                <input id="lastName" name="lastName" autocomplete="family-name" required />
              </div>
            </div>
            <label for="address">Address</label>
            <input id="address" name="address" autocomplete="address-line1" required />
            <div class="grid-2">
              <div>
                <label for="city">City</label>
                <input id="city" name="city" autocomplete="address-level2" required />
              </div>
              <div>
                <label for="zip">ZIP / Postal code</label>
                <input id="zip" name="zip" autocomplete="postal-code" required />
              </div>
            </div>
            <label for="notes">Delivery notes (optional)</label>
            <textarea id="notes" name="notes" rows="3" placeholder="e.g. Gate code, preferred time window"></textarea>
          </div>

          <div class="section" style="margin-top:14px;">
            <h2>Payment</h2>
            <div class="inline">
              <input type="radio" id="cod" name="payment" checked />
              <label for="cod" style="margin:0;">Cash on Delivery <span class="help">(Pay when you receive your package)</span></label>
            </div>
            <div class="actions">
              <button id="placeOrder" class="btn btn-primary" type="submit">Place COD Order</button>
              <div class="help">By placing your order you agree to our Terms and Privacy Policy.</div>
            </div>
          </div>
        </form>

        <aside>
          <div class="section summary">
            <div class="item">
              <img id="sumImage" src="" alt="Product" />
              <div>
                <div id="sumName" class="name">Selected Package</div>
                <div id="sumSku" class="sku">—</div>
              </div>
              <div style="margin-left:auto" id="sumPrice" class="price">$0.00</div>
            </div>
            <hr class="hr" />
            <div class="totals">
              <div class="line"><span class="muted">Subtotal</span><span id="subTotal">$0.00</span></div>
              <div class="line"><span class="muted">Shipping</span><span id="ship">FREE</span></div>
              <div class="line"><span class="muted">Payment</span><span>Cash on Delivery</span></div>
              <div class="line total"><span>Total</span><span id="grandTotal">$0.00</span></div>
            </div>
          </div>
          <div class="section" style="margin-top:14px;">
            <div class="help">60-day guarantee. Questions? Contact Support.</div>
          </div>
        </aside>
      </div>
    </div>
    <footer>© <span id="year"></span> Hammer of Night Rider</footer>
  </div>

  <script>
    (function(){
      const $ = (s)=>document.querySelector(s);
      const fmt = (n)=>{ try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'}).format(+n||0) }catch(e){ return '$'+Number(n||0).toFixed(2);} };

      const params = new URLSearchParams(location.search);
      const sku = (params.get('sku')||'').toUpperCase();
      const price = parseFloat(params.get('price')||'0');
      const productMap = {
        'EPK06': {name:'Best Value — 6 Bottles', img:'../images/img-PRODx6.png'},
        'EPK03': {name:'Most Popular — 3 Bottles', img:'../images/img-PRODx3.png'},
        'EPK02': {name:'Try Two — 2 Bottles',     img:'../images/img-PRODx2.png'}
      };
      const prod = productMap[sku] || {name:'Selected Package', img:'../images/img-PRODx3.png'};

      // Populate summary
      $('#sumName').textContent = prod.name;
      $('#sumSku').textContent = sku || '—';
      $('#sumImage').src = prod.img;
      $('#sumPrice').textContent = fmt(price);
      $('#subTotal').textContent = fmt(price);
      $('#grandTotal').textContent = fmt(price);
      $('#year').textContent = new Date().getFullYear();

      // Submit handler
      $('#codForm').addEventListener('submit', function(){
        // Minimal client-side validation
        const required = ['email','phone','firstName','lastName','address','city','zip'];
        for (const id of required){ const el = document.getElementById(id); if(!el || !el.value.trim()){ el && el.focus(); return; } }
        const order = {
          payment:'COD', sku, price,
          product: prod,
          contact:{ email: $('#email').value, phone: $('#phone').value },
          address:{ line1: $('#address').value, city: $('#city').value, zip: $('#zip').value },
          name: ($('#firstName').value||'')+' '+($('#lastName').value||''),
          notes: ($('#notes') && $('#notes').value) || '',
          createdAt: new Date().toISOString()
        };
        const btn = document.getElementById('placeOrder'); if (btn) btn.disabled = true;
        (async () => {
          try {
            const res = await fetch('../admin/api/order-create.php', {
              method: 'POST',
              headers: { 'Content-Type':'application/json' },
              credentials: 'same-origin',
              body: JSON.stringify(order)
            });
            if (res.ok) {
              const data = await res.json();
              if (data && data.ok) {
                order.orderNumber = data.order_number || null;
                order.orderId = data.order_id || null;
              }
            }
          } catch (e) { /* fallback only */ }
          try{ sessionStorage.setItem('lastOrder', JSON.stringify(order)); }catch(e){}
          location.href = 'thank-you.html';
        })();
      });
    })();
  </script>
</body>
</html>
